<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Website Builder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            min-height: 100dvh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
    </style>
</head>
<body class="bg-gray-900 text-white font-sans">
    <!-- Sidebar (Left) -->
    <div class="fixed left-0 top-0 bottom-0 w-64 bg-gray-800 border-r border-gray-700 flex flex-col">
        <!-- New Project Button -->
        <button id="newProjectBtn" class="m-4 p-2 bg-blue-500 hover:bg-blue-600 rounded text-white">+ New Project</button>
        
        <!-- Project List -->
        <div id="projectList" class="flex-1 overflow-y-auto p-4"></div>
        
        <!-- Settings Gear -->
        <button id="settingsBtn" class="p-4 text-center border-t border-gray-700">
            <svg class="w-6 h-6 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996-.608 2.296-.07 2.572-1.065z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
            </svg>
        </button>
    </div>

    <!-- Main Content Area -->
    <div class="ml-64 flex-1 flex flex-col overflow-hidden">
        <!-- Header (Top) -->
        <header class="flex items-center p-4 bg-gray-800 border-b border-gray-700">
            <!-- Traffic Dots -->
            <div class="flex space-x-2 mr-4">
                <div class="w-3 h-3 rounded-full bg-red-500"></div>
                <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
                <div class="w-3 h-3 rounded-full bg-green-500"></div>
            </div>
            
            <!-- Toggle Buttons -->
            <button id="previewToggle" class="px-4 py-2 bg-gray-700 rounded mr-2">Preview</button>
            <button id="codeToggle" class="px-4 py-2 bg-gray-700 rounded mr-2">Code</button>
            
            <!-- Download Button -->
            <button id="downloadBtn" class="px-4 py-2 bg-green-500 hover:bg-green-600 rounded">Download index.html</button>
        </header>
        
        <!-- Chat/Content Area -->
        <div id="chatArea" class="flex-1 overflow-y-auto p-4"></div>
        
        <!-- Footer (Bottom) -->
        <footer class="p-4 bg-gray-800 border-t border-gray-700 flex-shrink-0">
            <div class="flex">
                <textarea id="userInput" class="flex-1 p-2 bg-gray-700 border border-gray-600 rounded-l resize-none" rows="1" placeholder="Describe your website..."></textarea>
                <button id="sendBtn" class="px-4 bg-blue-500 hover:bg-blue-600 rounded-r">Send</button>
            </div>
        </footer>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
        <div class="bg-gray-800 p-6 rounded w-96">
            <h2 class="text-xl mb-4">Settings</h2>
            <div class="mb-4">
                <label class="block mb-1">API URL</label>
                <input id="apiUrlInput" type="text" class="w-full p-2 bg-gray-700 border border-gray-600 rounded" value="https://openrouter.ai/api/v1/chat/completions">
            </div>
            <div class="mb-4">
                <label class="block mb-1">API Key</label>
                <input id="apiKeyInput" type="password" class="w-full p-2 bg-gray-700 border border-gray-600 rounded">
            </div>
            <div class="mb-4">
                <label class="block mb-1">Model ID</label>
                <input id="modelIdInput" type="text" class="w-full p-2 bg-gray-700 border border-gray-600 rounded" value="deepseek/deepseek-r1:free">
            </div>
            <button id="saveSettingsBtn" class="px-4 py-2 bg-blue-500 hover:bg-blue-600 rounded w-full">Save</button>
        </div>
    </div>

    <script>
        const SYSTEM_PROMPT = "You are a web developer. Output ONLY raw HTML code. No explanations, no markdown, no code blocks. Just the pure HTML starting with <!DOCTYPE html>.";

        // LocalStorage Keys
        const STORAGE_KEYS = {
            projects: 'aiWebsiteBuilderProjects',
            settings: 'aiWebsiteBuilderSettings',
        };

        // Default Settings
        const defaultSettings = {
            apiUrl: 'https://openrouter.ai/api/v1/chat/completions',
            apiKey: '',
            model: 'deepseek/deepseek-r1:free',
        };

        // Load from localStorage
        let settings = JSON.parse(localStorage.getItem(STORAGE_KEYS.settings)) || defaultSettings;
        let projects = JSON.parse(localStorage.getItem(STORAGE_KEYS.projects)) || [];
        let currentProjectIndex = -1;
        let viewMode = 'preview'; // 'preview' or 'code'

        // Elements
        const newProjectBtn = document.getElementById('newProjectBtn');
        const projectList = document.getElementById('projectList');
        const settingsBtn = document.getElementById('settingsBtn');
        const settingsModal = document.getElementById('settingsModal');
        const apiUrlInput = document.getElementById('apiUrlInput');
        const apiKeyInput = document.getElementById('apiKeyInput');
        const modelIdInput = document.getElementById('modelIdInput');
        const saveSettingsBtn = document.getElementById('saveSettingsBtn');
        const previewToggle = document.getElementById('previewToggle');
        const codeToggle = document.getElementById('codeToggle');
        const downloadBtn = document.getElementById('downloadBtn');
        const chatArea = document.getElementById('chatArea');
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');

        // Functions
        function saveToLocalStorage() {
            localStorage.setItem(STORAGE_KEYS.settings, JSON.stringify(settings));
            localStorage.setItem(STORAGE_KEYS.projects, JSON.stringify(projects));
        }

        function loadProjects() {
            projectList.innerHTML = '';
            projects.forEach((project, index) => {
                const div = document.createElement('div');
                div.className = 'p-2 hover:bg-gray-700 cursor-pointer rounded ' + (index === currentProjectIndex ? 'bg-gray-600' : '');
                div.textContent = project.name || `Project ${index + 1}`;
                div.onclick = () => loadProject(index);
                projectList.appendChild(div);
            });
        }

        function createNewProject() {
            projects.push({ name: `Project ${projects.length + 1}`, messages: [], html: '' });
            currentProjectIndex = projects.length - 1;
            loadProjects();
            renderChat();
            saveToLocalStorage();
        }

        function loadProject(index) {
            currentProjectIndex = index;
            loadProjects();
            renderChat();
        }

        function renderChat() {
            chatArea.innerHTML = '';
            if (currentProjectIndex === -1) return;

            const project = projects[currentProjectIndex];
            project.messages.forEach(msg => {
                const div = document.createElement('div');
                div.className = 'mb-4 ' + (msg.role === 'user' ? 'text-right' : 'text-left');
                div.innerHTML = `<div class="inline-block p-3 rounded-lg \( {msg.role === 'user' ? 'bg-blue-600' : 'bg-gray-700'}"> \){msg.content}</div>`;
                chatArea.appendChild(div);
            });

            if (viewMode === 'preview') {
                const iframe = document.createElement('iframe');
                iframe.className = 'w-full h-96 border border-gray-600';
                iframe.srcdoc = project.html;
                chatArea.appendChild(iframe);
            } else if (viewMode === 'code') {
                const pre = document.createElement('pre');
                pre.className = 'p-4 bg-gray-800 overflow-auto';
                pre.textContent = project.html;
                chatArea.appendChild(pre);
            }

            chatArea.scrollTop = chatArea.scrollHeight;
        }

        async function sendMessage() {
            const prompt = userInput.value.trim();
            if (!prompt || currentProjectIndex === -1) return;

            const project = projects[currentProjectIndex];
            project.messages.push({ role: 'user', content: prompt });
            renderChat();
            userInput.value = '';

            const messages = [
                { role: 'system', content: SYSTEM_PROMPT },
                ...project.messages
            ];

            try {
                const response = await fetch(settings.apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${settings.apiKey}`,
                    },
                    body: JSON.stringify({
                        model: settings.model,
                        messages,
                    }),
                });

                const text = await response.text();
                if (!response.ok) {
                    alert("API Error: " + text);
                    return;
                }

                const data = JSON.parse(text);
                const html = data.choices[0].message.content.trim();

                project.messages.push({ role: 'assistant', content: html });
                project.html = html;
                renderChat();
                saveToLocalStorage();
            } catch (error) {
                alert("Error: " + error.message);
            }
        }

        function toggleView(mode) {
            viewMode = mode;
            previewToggle.classList.toggle('bg-gray-600', mode === 'preview');
            previewToggle.classList.toggle('bg-gray-700', mode !== 'preview');
            codeToggle.classList.toggle('bg-gray-600', mode === 'code');
            codeToggle.classList.toggle('bg-gray-700', mode !== 'code');
            renderChat();
        }

        function downloadHTML() {
            if (currentProjectIndex === -1) return;
            const project = projects[currentProjectIndex];
            const blob = new Blob([project.html], { type: 'text/html' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'index.html';
            a.click();
        }

        // Event Listeners
        newProjectBtn.onclick = createNewProject;
        settingsBtn.onclick = () => {
            apiUrlInput.value = settings.apiUrl;
            apiKeyInput.value = settings.apiKey;
            modelIdInput.value = settings.model;
            settingsModal.classList.remove('hidden');
        };
        saveSettingsBtn.onclick = () => {
            settings.apiUrl = apiUrlInput.value;
            settings.apiKey = apiKeyInput.value;
            settings.model = modelIdInput.value;
            saveToLocalStorage();
            settingsModal.classList.add('hidden');
        };
        settingsModal.onclick = (e) => {
            if (e.target === settingsModal) settingsModal.classList.add('hidden');
        };
        previewToggle.onclick = () => toggleView('preview');
        codeToggle.onclick = () => toggleView('code');
        downloadBtn.onclick = downloadHTML;
        sendBtn.onclick = sendMessage;
        userInput.onkeydown = (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        };

        // Initial Load
        loadProjects();
        if (projects.length > 0) {
            loadProject(0);
        }
    </script>
</body>
  </html>
